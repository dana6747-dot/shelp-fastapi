<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>ë¬¸ì œ ë¶„ì„ ì•±</title>
</head>
<body>
  <h1>ë¬¸ì œ ë¶„ì„ ì•±</h1>

  <!-- âœ… ì²´í¬ë°•ìŠ¤ ì˜ì—­ -->
  <h3>ì„¤ì •</h3>
  <label><input type="checkbox" id="fast_mode"> ë¹ ë¥¸ ëª¨ë“œ</label>
  <label><input type="checkbox" id="use_easyocr"> EasyOCR ì‚¬ìš©</label>
  <button onclick="saveSettings()">ì €ì¥</button>
  <hr>

  <!-- âœ… ì‚¬ì§„ ì—…ë¡œë“œ + í…ìŠ¤íŠ¸ ì…ë ¥ -->
  <h3>ë¬¸ì œ ì…ë ¥</h3>
  <input type="file" id="file"><br><br>
  <textarea id="text" placeholder="ë¬¸ì œ í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ ë¹„ì›Œë‘ë©´ OCR ì‚¬ìš©"></textarea><br>
  <button onclick="analyze()">ë¶„ì„í•˜ê¸°</button>

  <h3>ê²°ê³¼</h3>
  <pre id="result"></pre>

  <script>
    // ğŸ‘‰ ì„œë²„ ì£¼ì†Œ (í•„ìš”ì‹œ 127.0.0.1 ëŒ€ì‹  ì„œë²„ IPë¡œ êµì²´)
    const API = "http://127.0.0.1:5000";

    // ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadSettings() {
      const r = await fetch(API + "/settings");
      const d = await r.json();
      document.getElementById("fast_mode").checked = d.fast_mode;
      document.getElementById("use_easyocr").checked = d.use_easyocr;
    }

    // ì„¤ì • ì €ì¥í•˜ê¸°
    async function saveSettings() {
      const body = {
        fast_mode: document.getElementById("fast_mode").checked,
        use_easyocr: document.getElementById("use_easyocr").checked
      };
      await fetch(API + "/settings", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(body)
      });
      alert("ì €ì¥ë¨!");
    }

    // ë¶„ì„í•˜ê¸°
    async function analyze() {
      const fd = new FormData();
      const f = document.getElementById("file").files[0];
      if (f) fd.append("file", f);
      fd.append("text", document.getElementById("text").value);

      const r = await fetch(API + "/upload_analyze", {
        method: "POST",
        body: fd
      });
      const d = await r.json();
      document.getElementById("result").textContent = JSON.stringify(d, null, 2);
    }

    // í˜ì´ì§€ ì—´ ë•Œ ì„¤ì •ê°’ ë¶ˆëŸ¬ì˜¤ê¸°
    loadSettings();
  </script>
</body>
</html>
